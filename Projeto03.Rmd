---
title: "Projeto acadÃªmico - Projeto 3"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Projeto 3 - Prevendo Despesas Hospitalares

Para esta análise, usaremos um conjunto de dados simulando despesas médicas para um conjunto de pacientes de 4 regiões do Brasil. Esse dataset possui 1.338 observações e 7 variáveis.


## Etapa 1 - Coletando dados no github

Aqui iremos coletar os dados, neste caso um arquivo csv.


```{r coleta}
# Realiza a importação do arquivo CSV, contendo dados hospitalares dos pacientes do plano de saude.

# Inicia biblioteca
library(ggplot2)
library(ggthemes)
library(dplyr)
library(corrplot)
library(corrgram)


# Dataset público cedido pela DSA
df <- read.csv("http://datascienceacademy.com.br/blog/aluno/RFundamentos/Datasets/ML/despesas.csv")
```


## Etapa 2 - Inicia a análise explanatória dos dados



```{r explorando}
head(df)
str(df)
summary(df)
any(is.na(df))

# Obtendo apenas as colunas numÃ©ricas
colnum <- sapply(df, is.numeric)
colnum

# Filtrando as colunas numÃ©ricas para correlaÃ§Ã£o
data_cor <- cor(df[,colnum])
data_cor
head(data_cor)

# Compara relação entre as variáveis
corrplot(data_cor, method = 'color')

```


## Etapa 3 - Treinando modelo de regreção linear, atraves da função lm



```{r treinamento}
#install.packages("caTools")
library(caTools)

# Cria as amostras
set.seed(101)
amostra <- sample.split(df$gastos, SplitRatio = 0.70)

# Criação dos dados de treino e dados de teste

# Dados de treino - 70% dos dados
treino = subset(df, amostra == TRUE)
head(treino)
str(treino)

# Dados de teste - 30% dos dados
teste = subset(df, amostra == FALSE)
head(teste)
str(teste)

# Gerando o Modelo (Usando todos os atributos)
model1 <- lm(gastos ~ ., treino)

# ** Fazendo previsoes no modelo
prev1 <- predict(model1, teste)

```


## Etapa 4 - Avaliando resultado dos valores previstos e observados e performance


```{r resultado}
# Avalia performance do Modelo
summary(model1)

# Visualizando os valores previstos e observados
resultados <- cbind(prev1, teste$gastos) 
colnames(resultados) <- c('Previsto','Real')
resultados <- as.data.frame(resultados)
resultados
min(resultados)
max(resultados)


```


## Etapa 5 - Avalia nível de precisão do modelo


```{r avaliacao}
# Calculando R Squared
SSE = sum((resultados$Previsto - resultados$Real)^2)
SST = sum( (mean(df$gastos) - resultados$Real)^2)

# R-Squared
# Ajuda a avaliar o nÃ?vel de precisÃ£o do nosso modelo. Quanto maior, melhor, sendo 1 o valor ideal.
R2 = 1 - (SSE/SST)
R2

```

## Fim


