---
title: "Prevendo gastos Hospitalares - Projeto 3"
author: "Rodrigo Gomes Moraes"
date: "February 02, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Projeto 3 - Prevendo Despesas Hospitalares

Para esta análise, iremos utilizar um conjunto de dados simulando despesas médicas para um conjunto de pacientes espalhados por 4 regiões do Brasil. Esse dataset possui 1.338 observaÃ§Ãµes e 7 variáveis.


## Passo 1 - Coletando os Dados

Aqui estão a coleta de dados, neste caso um arquivo csv.


```{r coleta}
# Coletando dados
despesas <- read.csv("http://datascienceacademy.com.br/blog/aluno/RFundamentos/Datasets/ML/despesas.csv")
```


## Etapa 2 - Explorando os Dados



```{r explorando}
# Visualizando as variÃ¡veis
str(despesas)

# Medias de TendÃªncia Central da variÃ¡vel gastos
summary(despesas$gastos)

# Construindo um histograma
hist(despesas$gastos, main = 'Histograma', xlab = 'Gastos')

# Tabela de contingÃªncia das regiÃµes
table(despesas$regiao)

# Explorando relacionamento entre as variÃ¡veis: Matriz de CorrelaÃ§Ã£o
cor(despesas[c("idade", "bmi", "filhos", "gastos")])

# Nenhuma das correlaÃ§Ãµes na matriz sÃ£o consideradas fortes, mas existem algumas associaÃ§Ãµes interessantes. 
# Por exemplo, a idade e o bmi (IMC) parecem ter uma correlaÃ§Ã£o positiva fraca, o que significa que 
# com o aumento da idade, a massa corporal tende a aumentar. HÃ¡ tambÃ©m uma correlaÃ§Ã£o positiva 
# moderada entre a idade e os gastos, alÃ©m do nÃºmero de filhos e os gasos. Estas associaÃ§Ãµes implicam 
# que, Ã  media que idade, massa corporal e nÃºmero de filhos aumenta, o custo esperado do seguro saÃºde sobe. 

# Visualizando relacionamento entre as variÃ¡veis: Scatterplot
# Perceba que nÃ£o existe um claro relacionamento entre as variÃ¡veis
pairs(despesas[c("idade", "bmi", "filhos", "gastos")])

# Scatterplot Matrix
# install.packages("psych")
library(psych)
# Este grÃ¡fico fornece mais informaÃ§Ãµes sobre o relacionamento entre as variÃ¡veis
pairs.panels(despesas[c("idade", "bmi", "filhos", "gastos")])

```


## Etapa 3 - Treinando o modelo




```{r treinamento}
modelo <- lm(gastos ~ idade + filhos + bmi + sexo + fumantes + regiao,
                data = despesas)

# Similar ao item anterior
modelo <- lm(gastos ~ ., data = despesas)

# Visualizando os coeficientes
modelo

# Prevendo despesas mÃ©dicas 
previsao <- predict(modelo)
class(previsao)
head(previsao)

```


## Etapa 4 - Avaliando a Performance do Modelo



```{r performance}
# Mais detalhes sobre o modelo
summary(modelo)


```


## Etapa 5 - OtimizaÃ§Ã£o do Modelo
 
 
 
```{r otimizacao}
# Adicionando uma variÃ¡vel com o dobro do valor das idades
despesas$idade2 <- despesas$idade ^ 2

# Adicionando um indicador para BMI >= 30
despesas$bmi30 <- ifelse(despesas$bmi >= 30, 1, 0)

# Criando o modelo final
modelo_v2 <- lm(gastos ~ idade + idade2 + filhos + bmi + sexo +
                   bmi30 * fumantes + regiao, data = despesas)

summary(modelo_v2)
```





## Fim
## www.datascienceacademy.com.br

